<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartHelp â€“ Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<nav class="top-nav">
  <a href="index.html">Abrir ticket</a>
  <a href="consultar-ticket.html">Consultar ticket</a>
  <a href="login.html">Login tÃ©cnico</a>
  <a href="painel.html">Painel tÃ©cnico</a>
  <a href="dashboard.html">Dashboard</a>
</nav>

<header>ðŸ“Š Dashboard de Tickets</header>

<div class="container">
  <h2>Tickets por Categoria</h2>
  <canvas id="catChart"></canvas>
</div>

<div class="container">
  <h2>Tickets por Prioridade</h2>
  <canvas id="prioChart"></canvas>
</div>

<div class="container">
  <h2>Tickets por Estado</h2>
  <canvas id="estadoChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
  import { firebaseConfig } from "./firebase.js";

  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  async function gerarDashboard() {
    const snap = await getDocs(collection(db, "tickets"));

    let categorias  = {};
    let prioridades = {};
    let estados     = {};

    snap.forEach(d => {
      const t = d.data();

      categorias[t.categoria]  = (categorias[t.categoria]  || 0) + 1;
      prioridades[t.prioridade] = (prioridades[t.prioridade] || 0) + 1;
      estados[t.estado]        = (estados[t.estado]        || 0) + 1;
    });

    // Categoria
    new Chart(document.getElementById("catChart"), {
      type: "bar",
      data: {
        labels: Object.keys(categorias),
        datasets: [{
          label: "Tickets",
          data: Object.values(categorias),
          backgroundColor: "#1a73e8"
        }]
      }
    });

    // Prioridade
    new Chart(document.getElementById("prioChart"), {
      type: "pie",
      data: {
        labels: Object.keys(prioridades),
        datasets: [{
          data: Object.values(prioridades),
          backgroundColor: ["#4CAF50","#FFC107","#FF5722","#9C27B0"]
        }]
      }
    });

    // Estado
    new Chart(document.getElementById("estadoChart"), {
      type: "doughnut",
      data: {
        labels: Object.keys(estados),
        datasets: [{
          data: Object.values(estados),
          backgroundColor: ["#4ade80","#facc15","#f87171","#60a5fa"]
        }]
      }
    });
  }

  gerarDashboard();
</script>

</body>
</html>
